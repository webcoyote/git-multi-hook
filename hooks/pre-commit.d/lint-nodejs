#!/usr/bin/env bash
# Run lint command for Node.js projects
set -Eeuo pipefail
trap 'echo "${BASH_SOURCE[0]}: line $LINENO: $BASH_COMMAND: exitcode $?"' ERR
# shellcheck source-path=SCRIPTDIR
source "$(dirname "${BASH_SOURCE[0]}")/../__common"

cd "$(repo_dir)"

# Check if this is a Node.js project
if [[ ! -f "package.json" ]]; then
    debug "package.json not found; skipping nodejs lint"
    exit 0
fi

# Check if package.json has a lint script
if ! rg -q '"lint"' package.json; then
    debug "No lint script found in package.json; skipping"
    exit 0
fi

# Determine which package manager to use
if [[ -f "pnpm-lock.yaml" ]]; then
    PKG_MANAGER="pnpm"
elif [[ -f "yarn.lock" ]]; then
    PKG_MANAGER="yarn"
else
    PKG_MANAGER="npm"
fi

# Check if package manager is available
if ! command -v "$PKG_MANAGER" &>/dev/null; then
    warn "$PKG_MANAGER not found; skipping nodejs lint"
    exit 0
fi

# Run the lint command
exec "$PKG_MANAGER" run lint
